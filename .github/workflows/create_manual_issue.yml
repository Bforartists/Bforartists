name: Create issue in manual when a PR is merged

on:
  pull_request:
    types: [closed]   # Der Job läuft nur bei geschlossenen PRs (inklusive Merge)

jobs:
  create_issue_on_merge:
    runs-on: ubuntu-latest
    # Nur wenn der PR wirklich gemerged wurde
    if: github.event.pull_request.merged == true

    permissions:
      contents: read          # Für actions/checkout (falls du Code brauchst)
      issues: write           # Damit wir Issues im Zielrepo anlegen können

    steps:
      - name: Checkout source repo (bforartists/bforartists)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0   # optional, falls du später Git‑History brauchst

      - name: Create issue in manual repo
        env:
          GH_PAT_AUTO_ISSUE: ${{ secrets.GH_PAT_AUTO_ISSUE }}
        run: |
          PR_NUM="${{ github.event.pull_request.number }}"
          TARGET_REPO="bforartists/manual"
          TITLE="Merged PR #$PR_NUM"
          BODY=$(printf '%s' "Pull request #$PR_NUM was merged into `master` of **bforartists/bforartists**.\n\nPlease review the changes and verify that they meet our quality standards.")

          echo "Creating issue: $TITLE"

          curl -s \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: token ${GH_PAT_AUTO_ISSUE}" \
            -X POST \
            -d "{\"title\":\"$TITLE\",\"body\":\"$BODY\"}" \
            https://api.github.com/repos/$TARGET_REPO/issues
